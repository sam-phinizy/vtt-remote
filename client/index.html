<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#e94560">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>VTT Remote</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="assets/icon.svg">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
  <div id="app">
    <!-- Auth Screen (Login or Pairing) -->
    <section id="pairing-screen" class="screen active">
      <h1>VTT Remote</h1>

      <!-- Auth Mode Tabs -->
      <nav class="auth-tabs">
        <button class="auth-tab active" data-mode="login">Login</button>
        <button class="auth-tab" data-mode="pairing">QR/Code</button>
      </nav>

      <!-- Login Form -->
      <form id="login-form" class="auth-form">
        <div class="input-group">
          <label for="login-room-code">Room Code</label>
          <input
            type="text"
            id="login-room-code"
            name="roomCode"
            placeholder="e.g., GAME1"
            autocomplete="off"
            autocapitalize="characters"
            required
          >
        </div>
        <div class="input-group">
          <label for="login-username">Username</label>
          <input
            type="text"
            id="login-username"
            name="username"
            placeholder="Your Foundry username"
            autocomplete="username"
            required
          >
        </div>
        <div class="input-group">
          <label for="login-password">Password</label>
          <input
            type="password"
            id="login-password"
            name="password"
            placeholder="Your remote password"
            autocomplete="current-password"
            required
          >
        </div>
        <button type="submit" id="login-btn">Login</button>
      </form>

      <!-- Pairing Form (hidden by default) -->
      <form id="pairing-form" class="auth-form hidden">
        <div class="input-group">
          <label for="room-code">Room Code</label>
          <input
            type="text"
            id="room-code"
            name="roomCode"
            placeholder="e.g., GAME1"
            autocomplete="off"
            autocapitalize="characters"
            required
          >
        </div>
        <div class="input-group">
          <label for="pairing-code">Pairing Code</label>
          <input
            type="text"
            id="pairing-code"
            name="pairingCode"
            placeholder="e.g., 5599"
            inputmode="numeric"
            pattern="[0-9]{4}"
            maxlength="4"
            autocomplete="off"
            required
          >
        </div>
        <button type="submit" id="connect-btn">Connect</button>
        <div class="form-divider"><span>or</span></div>
        <button type="button" id="scan-qr-btn" class="scan-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
            <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
            <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
            <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
            <rect x="7" y="7" width="10" height="10"/>
          </svg>
          Scan QR Code
        </button>
      </form>

      <p id="status-message" class="status"></p>

      <!-- QR Scanner Modal -->
      <div id="qr-scanner-modal" class="scanner-modal hidden">
        <div class="scanner-header">
          <h2>Scan QR Code</h2>
          <button id="close-scanner-btn" class="icon-btn" title="Close">×</button>
        </div>
        <div id="qr-reader"></div>
        <p class="scanner-hint">Point camera at QR code from Foundry</p>
      </div>
    </section>

    <!-- Token Picker Screen (after login) -->
    <section id="token-picker-screen" class="screen">
      <header>
        <span id="picker-username">Username</span>
        <button id="picker-logout-btn" class="icon-btn" title="Logout">×</button>
      </header>
      <h2>Select Token</h2>
      <div id="token-list" class="token-list">
        <!-- Dynamically populated with available tokens -->
      </div>
      <p id="no-tokens-message" class="notes hidden">No tokens available to control</p>
    </section>

    <!-- Control Screen -->
    <section id="control-screen" class="screen">
      <header>
        <button id="switch-token-btn" class="icon-btn" title="Switch Token">⇄</button>
        <span id="actor-name">Token Name</span>
        <button id="disconnect-btn" class="icon-btn" title="Disconnect">×</button>
      </header>

      <!-- Tab Navigation -->
      <nav class="screen-tabs">
        <button class="tab active" data-tab="dpad">D-Pad</button>
        <button class="tab" data-tab="dice">Dice</button>
        <button class="tab" data-tab="info">Info</button>
      </nav>

      <!-- D-Pad Tab Content -->
      <div id="dpad-content" class="tab-content active">
        <div id="dpad" class="dpad">
          <button class="dpad-btn" data-dir="up" aria-label="Move Up">▲</button>
          <button class="dpad-btn" data-dir="left" aria-label="Move Left">◀</button>
          <button class="dpad-btn" data-dir="right" aria-label="Move Right">▶</button>
          <button class="dpad-btn" data-dir="down" aria-label="Move Down">▼</button>
        </div>
      </div>

      <!-- Dice Tab Content -->
      <div id="dice-content" class="tab-content">
        <div class="dice-quick-buttons">
          <button class="dice-btn" data-formula="1d4">d4</button>
          <button class="dice-btn" data-formula="1d6">d6</button>
          <button class="dice-btn" data-formula="1d8">d8</button>
          <button class="dice-btn" data-formula="1d10">d10</button>
          <button class="dice-btn" data-formula="1d12">d12</button>
          <button class="dice-btn" data-formula="1d20">d20</button>
        </div>

        <div class="dice-custom">
          <input
            type="text"
            id="dice-formula"
            placeholder="e.g., 2d6+3"
            autocomplete="off"
            autocapitalize="off"
          >
          <button id="roll-custom-btn" class="dice-roll-btn">Roll</button>
        </div>

        <div class="dice-options">
          <label class="toggle-label">
            <input type="checkbox" id="post-to-chat" checked>
            <span>Post to Foundry chat</span>
          </label>
        </div>

        <div id="dice-result" class="dice-result hidden">
          <div class="dice-result-total" id="dice-total"></div>
          <div class="dice-result-breakdown" id="dice-breakdown"></div>
          <div class="dice-result-formula" id="dice-formula-display"></div>
        </div>
      </div>

      <!-- Info Tab Content -->
      <div id="info-content" class="tab-content">
        <div class="actor-portrait">
          <img id="actor-portrait" src="" alt="Actor portrait">
        </div>

        <div class="resources" id="resources-container">
          <!-- Dynamically populated -->
        </div>

        <div class="stats" id="stats-container">
          <!-- Dynamically populated -->
        </div>

        <div class="conditions" id="conditions-container">
          <!-- Dynamically populated -->
        </div>

        <div class="abilities" id="abilities-container">
          <!-- Dynamically populated: weapons, spells, features, consumables -->
        </div>

        <p id="no-info-message" class="notes">No actor info available</p>
      </div>

      <!-- Confirm Ability Dialog -->
      <div id="confirm-dialog" class="confirm-dialog hidden">
        <div class="confirm-dialog-content">
          <h3 id="confirm-title">Use Ability?</h3>
          <p id="confirm-description"></p>
          <div class="confirm-buttons">
            <button id="confirm-cancel" class="confirm-btn cancel">Cancel</button>
            <button id="confirm-use" class="confirm-btn use">Use</button>
          </div>
        </div>
      </div>

      <footer>
        <span id="connection-status" class="connected">Connected</span>
      </footer>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
